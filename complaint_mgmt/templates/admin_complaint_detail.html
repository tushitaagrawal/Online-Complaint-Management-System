{% extends 'base.html' %}
{% block content %}
<div class="container">
  <h2>Manage Complaint #{{ comp.id }} – {{ comp.title }}</h2>
  <p><strong>User:</strong> {{ comp.user_name }} ({{ comp.email }})</p>
  <p><strong>Category:</strong> {{ comp.category }} &nbsp; | &nbsp; <strong>Priority:</strong> {{ comp.priority }}</p>
  <p><strong>Current Status:</strong> {{ comp.status }} &nbsp; | &nbsp; <strong>Created:</strong> {{ comp.created_at }}</p>
  <p>{{ comp.description }}</p>

  <h3>Update Status</h3>
  <form method="post">
    <label>New Status</label>
    <select name="status">
      <option {% if comp.status=='Submitted' %}selected{% endif %}>Submitted</option>
      <option {% if comp.status=='In Progress' %}selected{% endif %}>In Progress</option>
      <option {% if comp.status=='Resolved' %}selected{% endif %}>Resolved</option>
      <option {% if comp.status=='Closed' %}selected{% endif %}>Closed</option>
    </select>

    <label>Note (optional)</label>
    <textarea name="note" rows="4" placeholder="Add a short note about this update..."></textarea>

    <button class="btn" type="submit">Save</button>
  </form>

  <h3>History</h3>
  <table class="table">
    <tr><th>When</th><th>By</th><th>Old → New</th><th>Note</th></tr>
    {% for h in history %}
    <tr>
      <td>{{ h.action_at }}</td>
      <td>{{ h.actor_name }}</td>
      <td>{{ h.old_status }} → {{ h.new_status }}</td>
      <td>{{ h.note }}</td>
    </tr>
    {% else %}
    <tr><td colspan="4">No history yet.</td></tr>
    {% endfor %}
  </table>
</div>
{% endblock %}